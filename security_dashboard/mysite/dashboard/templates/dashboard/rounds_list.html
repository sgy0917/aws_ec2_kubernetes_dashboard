{% extends 'dashboard/base.html' %}

{% block title %}íšŒì°¨ë³„ ì ê²€ í˜„í™© - ìì‚° ì ê²€ ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block extra_css %}
<style>
    /* ì»¨í…ì¸  ì˜ì—­ ì œí•œ */
    body {
        background: #f5f5f5;
    }
    
    .container-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background: white;
        min-height: 100vh;
    }

    .filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 6px;
        margin-bottom: 30px;
        border: 1px solid #e9ecef;
    }

    .filter-title {
        font-size: 15px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 15px;
    }

    .filter-row {
        display: grid;
        grid-template-columns: auto 1fr auto 1fr auto auto;
        gap: 12px;
        align-items: center;
    }

    .filter-label {
        font-size: 15px;
        color: #6c757d;
        white-space: nowrap;
    }

    .filter-input, .filter-select {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 15px;
        background: white;
    }

    .date-section {
        margin-bottom: 30px;
    }

    .date-header {
        background: #f8f9fa;
        padding: 12px 20px;
        border-radius: 6px 6px 0 0;
        border: 1px solid #dee2e6;
        border-bottom: none;
    }

    .date-header strong {
        font-size: 20px;
        color: #495057;
    }

    .rounds-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border: 1px solid #dee2e6;
    }

    .rounds-table thead {
        background: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }

    .rounds-table th {
        padding: 14px 16px;
        text-align: left;
        font-size: 15px;
        font-weight: 600;
        color: #495057;
    }

    .rounds-table th:first-child {
        text-align: center;
        width: 80px;
    }

    .rounds-table tbody tr {
        border-bottom: 1px solid #e9ecef;
        cursor: pointer;
        transition: background 0.2s;
    }

    .rounds-table tbody tr:hover {
        background: #f8f9fa;
    }

    .rounds-table td {
        padding: 16px;
        font-size: 15px;
        color: #212529;
        vertical-align: middle;
    }

    .rounds-table td:first-child {
        text-align: center;
        font-weight: 600;
        color: #7c4dff;
        padding: 16px;
    }

    .round-badge {
        display: inline-block;
        padding: 6px 16px;
        background: #e8deff;
        color: #333;
        border-radius: 20px;
        font-size: 15px;
        font-weight: 600;
        white-space: nowrap;
        line-height: 1.4;
    }

    .stat-inline {
        display: inline-flex;
        gap: 20px;
    }

    .stat-inline-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .stat-inline-label {
        font-size: 13px;
        color: #6c757d;
    }

    .stat-inline-value {
        font-size: 18px;
        font-weight: 600;
    }

    .stat-good { color: #28a745; }
    .stat-warning { color: #ffc107; }
    .stat-bad { color: #dc3545; }
    .stat-info { color: #6c757d; }

    .empty-message {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
        font-size: 18px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-wrapper">
    <h2 style="margin-bottom: 20px; font-size: 22px; font-weight: 600; color: #212529;">
        ğŸ“… ì ê²€ íšŒì°¨ë³„ í˜„í™©
    </h2>

    <!-- í•„í„° ì„¹ì…˜ -->
	<div class="filter-section">	
	    <div class="filter-title">ğŸ” í•„í„°ë§</div>
	    <form method="get" class="filter-row">
		<span class="filter-label">ì ê²€ ë‚ ì§œ</span>
		<select name="date" class="filter-select">
		    <option value="">ì „ì²´</option>
		    {% for date in all_dates %}
		    <option value="{{ date|date:'Y-m-d' }}" {% if filter_date == date|date:"Y-m-d" %}selected{% endif %}>
			{{ date }}
		    </option>
		    {% endfor %}
		</select>
		
		<span class="filter-label">íšŒì°¨</span>
		<select name="round" class="filter-select">
		    <option value="">ì „ì²´</option>
		    {% for round_num in all_rounds %}
		    <option value="{{ round_num }}" {% if filter_round == round_num|stringformat:"s" %}selected{% endif %}>
			{{ round_num }}íšŒì°¨
		    </option>
		    {% endfor %}
		</select>
		
		<button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
		<a href="{% url 'dashboard:rounds_list' %}" class="btn btn-secondary">ì´ˆê¸°í™”</a>
	    </form>
	</div>
    <!-- ë‚ ì§œë³„ í…Œì´ë¸” -->
    {% if rounds_list %}
        {% for date_group in rounds_list %}
        <div class="date-section">
            <div class="date-header">
                <strong>ğŸ“… {{ date_group.date }}</strong>
            </div>
            <table class="rounds-table">
                <thead>
                    <tr>
                        <th>íšŒì°¨</th>
                        <th>ì ê²€ ì¼ì‹œ</th>
                        <th>ì´ ìì‚° ìˆ˜</th>
                        <th>ì ê²€ í†µê³„</th>
                    </tr>
                </thead>
                <tbody>
                    {% for round in date_group.rounds %}
                    <tr onclick="location.href='{% url 'dashboard:round_detail' round.id %}'">
                        <td>
                            <span class="round-badge">{{ round.round_number }}íšŒì°¨</span>
                        </td>
                        <td>{{ round.datetime_str }}</td>
                        <td><strong>{{ round.total_assets }}ê°œ</strong></td>
                        <td>
                            <div class="stat-inline">
                                <div class="stat-inline-item">
                                    <span class="stat-inline-label">ì–‘í˜¸</span>
                                    <span class="stat-inline-value stat-good">{{ round.stats.total_passed }}</span>
                                </div>
                                <div class="stat-inline-item">
                                    <span class="stat-inline-label">ì£¼ì˜</span>
                                    <span class="stat-inline-value stat-warning">{{ round.stats.total_warnings }}</span>
                                </div>
                                <div class="stat-inline-item">
                                    <span class="stat-inline-label">ì·¨ì•½</span>
                                    <span class="stat-inline-value stat-bad">{{ round.stats.total_failed }}</span>
                                </div>
                                <div class="stat-inline-item">
                                    <span class="stat-inline-label">í•´ë‹¹ì—†ìŒ</span>
                                    <span class="stat-inline-value stat-info">{{ round.stats.total_na }}</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-message">
            <p>ğŸ”­ í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <p style="font-size: 14px; margin-top: 10px; color: #6c757d;">
                {% if filter_date and filter_round %}
                    ë‚ ì§œ: {{ filter_date }}, íšŒì°¨: {{ filter_round }}íšŒì°¨ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% elif filter_date %}
                    ë‚ ì§œ: {{ filter_date }}ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% elif filter_round %}
                    {{ filter_round }}íšŒì°¨ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% else %}
                    ì ê²€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% endif %}
            </p>
            <a href="{% url 'dashboard:rounds_list' %}" class="btn btn-primary" style="margin-top: 15px; display: inline-block; padding: 10px 20px; border-radius: 4px; text-decoration: none;">
                ì „ì²´ ë³´ê¸°
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
